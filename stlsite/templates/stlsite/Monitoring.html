<html>
  <head>
    <title>Monitoring </title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
  </head>
  <style type "text/css">
  #container  { background-color:#F0F0F0; width:1600px; margin:0 auto; }
  #header   { background-color:#908886; height:100px; }
  #title  { background-color:#F5F5F5; float:left; width:800px; height:100px; }
  #Menu  { background-color:#708877; float:left; width:800px; height:100px; }
  #icon  { background-color:#444444; float:left; width:800px; height:50px; }

  </style>
  <body>
  <div id="container">
  <div id="title"><h1>Monitoring</h1></div>
  <div id="Menu" >
    <input style="margin-left: 50px; margin-top: 10px; WIDTH: 120pt; HEIGHT: 60pt" type=button value="Home"  OnClick="window.location='/STLight/'">
    <input style="margin-left: 20px; WIDTH: 120pt; HEIGHT: 60pt"  type=button value="StreetLight"  OnClick="window.location='/SetRepeater/'">
    <input style="margin-left: 20px; WIDTH: 120pt; HEIGHT: 60pt"  type=button value="Monitoring"  OnClick="window.location='/Monitoring/'">
    <input style="margin-left: 20px; WIDTH: 120pt; HEIGHT: 60pt"  type=button value="CommandHistory"  OnClick="window.location='/CommandHistory/'">

  </div>
  <div style="width: 50%; height: 50%; float:left;" id="map" ></div>
  <div style="width: 50%; height: 50%; float:left;" id="map_second"></div>
  <div>
  <h2 align=center>Monitoring Table</h2>
  <table cellspacing=1 width=1000 align=center border=1>
  <tr>
    <td width=50><p align=center>NO</p></td>
    <td width=100><p align=center>Device Code</p></td>
    <td width=320><p align=center>Location</p></td>
    <td width=100><p align=center>Zone</p></td>
    <td width=100><p align=center>수신시간</p></td>
    <td width=100><p align=center>응답시간</p></td>
    <td width=100><p align=center>고장여부</p></td>

  </tr>
    <ul>
      {% if Location %}
        {% for boardRow in Location %}
        <tr>
        <td width=50><p align=center><a href="/STLInfo/{{boardRow.id}}" onclick="window.open(this.href,'STLInfo','width=820,height=570,top=50,left=150'); return false"  >{{ boardRow.id }}</a></p></td>
        <td width=100><p align=center><a href="/STLInfo/{{boardRow.id}}" onclick="window.open(this.href,'STLInfo','width=820,height=570,top=50,left=150'); return false" >{{ boardRow.code }}</a></p></td>
        <td width=100><p align=center>{{ boardRow.loc }}</p></td>
        <td width=100><p align=center>{{ boardRow.zone.zoneName }}</p></td>
        <td width=100><p align=center>{{ boardRow.luminous }}%</p></td>
        <td width=100><p align=center>{{ boardRow.sTLMonitorTime }}</p></td>
        <td width=100><p align=center>{{ boardRow.sTLMonitorTime }}</p></td>
        </tr>
        {% endfor %}
    </ul>
  {% else %}
    <p>No Data.</p>
    <tr>
    <td width=50, height = 20><p align=center>{{ boardRow.id }}</p></td>
    <td width=100><p align=center>{{ boardRow.code }}</p></td>
      <td width=100><p align=center>{{ boardRow.loc }}</p></td>
    <td width=100><p align=center>{{ boardRow.zone.zoneName }}</p></td>
    <td width=100><p align=center>{{ boardRow.luminous }}%</p></td>
    <td width=100><p align=center>{{ boardRow.sTLMonitorTime }}</p></td>
    <td width=100><p align=center>{{ boardRow.sTLMonitorTime }}</p></td>
    </tr>
  {% endif %}
  </table>
  {% for page in totalPageList %}
      <a href="/listSpecificPageWork?current_page={{page}}" >
      [
      {% ifequal page current_page %}
          <b>
      {% endifequal %}
      {{page}}

      {% ifequal page current_page  %}
          </b>
      {% endifequal %}
      ]
  {% endfor %}
  </td> </tr>
  </table>
  <table width=1000 align=center>
        <tr><td width = 10><input type=button value="Input"  OnClick="window.location='/'"></td>
            <td><form name=searchf method=post action="/searchZone/">
              {% csrf_token %}
                <p align=right>zone: <input type=text name=searchZone size=18  maxlength=50>
                <input type=submit value="Search"></p>
              </form>
            </td>
        </tr>
    </table>
  </div>
    </body>

  </html>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEXAlEGffz0nDACY-PTPg3kiTFWPGyatY&callback=initMap" async defer></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEXAlEGffz0nDACY-PTPg3kiTFWPGyatY&libraries=drawing&callback=initMap"async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

<script>

//E-space 건물에 대한 주소
var latlng = new google.maps.LatLng('37.483573', '126.892567');

//streetLight 아이콘 호출 주소 (url만 입력 가능 )따라서 google docs를 이용해서 이미지를 google drive에 저장후 해당 url을 호출
var STLight_60_1 = new google.maps.MarkerImage('https://docs.google.com/uc?export=download&id=0ByKVQAUvgcIzMU1zTjFzbGZYN2M', null, null, null, new google.maps.Size(70,60));
var STLight_90 = new google.maps.MarkerImage('https://docs.google.com/uc?export=download&id=0ByKVQAUvgcIzTHIwc2RIYy1YM00', null, null, null, new google.maps.Size(70,60));
var STLight_100 = new google.maps.MarkerImage('https://docs.google.com/uc?export=download&id=0ByKVQAUvgcIzek9sTEo0dHpaazg', null, null, null, new google.maps.Size(70,60));
var STLight_0_1 = new google.maps.MarkerImage('https://docs.google.com/uc?export=download&id=0ByKVQAUvgcIzdTN4RmJ3QjVINFU', null, null, null, new google.maps.Size(70,60));
var STLight_30_1 = new google.maps.MarkerImage('https://docs.google.com/uc?export=download&id=0ByKVQAUvgcIzdUVGRVRGMXp5dTg', null, null, null, new google.maps.Size(70,60));

//초기 변수 설정
var zoneClicked = true;
var cellClicked = true;
var lightClicked = true;
var repeaterClicked = true;
var flag = [];
var infowindow = new google.maps.InfoWindow;
var geocoder = new google.maps.Geocoder;

//Zone의 최대 최소 사각형 영역을 위한 설정.
var boundary = new Array();
boundary['north']= 0;
boundary['south']= 1000;
boundary['east']= 0;
boundary['west']= 1000;

//initmap: googlemap을 호출 하고 googl map과 관련된 일을 처리하는 부분
function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 37.483573, lng: 126.892567},
    zoom: 18
  });
  var map_second = new google.maps.Map(document.getElementById('map_second'), {
    center: {lat: 37.483573, lng: 126.892567},
    zoom: 9
  });

  //drawing 매니저를 호출해 zone영역을 사용자가 직접 설정 할 수 있도록 도움
  var drawingManager = new google.maps.drawing.DrawingManager({
    drawingControl: true,
    drawingControlOptions: {
      position: google.maps.ControlPosition.TOP_CENTER,
      drawingModes: [
        google.maps.drawing.OverlayType.RECTANGLE,
        google.maps.drawing.OverlayType.POLYGON
      ]
    },

    //각각의 도형의 색, 선색 두께 등을 설정 할 수 있다.
    rectangleOptions: {
      strokeColor: '#FF0000',
      strokeWeight: 1,
      clickable: true,
      editable: true,
       fillColor: '#ff00ff',
      zIndex: 1
    }
  });  drawingManager.setMap(map);

  //STLight DB를 호출 하는 부분
  {% for Locations in Location %}
              latlng = new google.maps.LatLng("{{ Locations.posX }}", "{{ Locations.posY }}");
              boundary=  Boundary( {{Locations.posX}}, {{Locations.posY}}, boundary );

              //Luminous에 따라서 각기 다른 아이콘 호출
              if({{Locations.luminous}} == 0)
                icons = STLight_0_1;
              else if({{Locations.luminous}} <=30)
                icons = STLight_30_1;
              else if({{Locations.luminous}} <=60)
                icons = STLight_60_1;
              else if({{Locations.luminous}} <=90)
                icons = STLight_90;
              else if({{Locations.luminous}} <100)
                icons = STLight_100;

              //마커를 구글 맵에 입력
              var marker = new google.maps.Marker({
                  position: latlng,
                  icon: icons,
                  map: map,
                  title:"{{ Locations.flag }}"
              });

              //마커 클릭시 해당 마커에 매핑되는  STLight 정보 창 오픈 함수
              attachInfomation(marker,{{Locations.id}});
  {% endfor %}
}
</script>

<!-- jsp함수 영역  -->
<script>
function attachInfomation(marker, id) {
  marker.addListener('click', function() {
    window.open("/STLInfo/"+id,'popup','width=820,height=570,top=50,left=150');
  });
}

function Boundary(x, y,boundary)
{
  if(boundary.south>y)
    boundary.south = y;
  if(boundary.north<y)
    boundary.north = y;
  if(boundary.east<x)
    boundary.east = x;
  if(boundary.west>x)
    boundary.west = x;
  return boundary;
}

function geocodeLatLng(geocoder, map, infowindow)
{
  var input = document.getElementById('latlng').value;
  var latlngStr = input.split(',', 2);
  var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
  geocoder.geocode({'location': latlng}, function(results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      if (results[1]) {
        map.setZoom(15);
        var marker = new google.maps.Marker({
          position: latlng,
          map: map
        });
        infowindow.setContent(results[1].formatted_address);
        infowindow.open(map, marker);
      } else {
        window.alert('No results found');
      }
    } else {
      window.alert('Geocoder failed due to: ' + status);
    }
  });
}

function winpopupZone(zoneClicked)
{
  window.open("/zoneSetting",'popup','width=220,height=270,top=20,left=50');
  return false;
}
function winpopupCell()
{
  window.open("/cellSetting",'popup','width=220,height=270,top=20,left=50');
  return false;
}
</script>

<!-- Google Api key 입력 부분, Google API key는 구글 홈페이지에서 발급 받아야 함 -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEXAlEGffz0nDACY-PTPg3kiTFWPGyatY&libraries=drawing&callback=initMap"async defer></script>
